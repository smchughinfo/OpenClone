# LogViewer

## Overview
LogViewer is a real-time web application for monitoring and analyzing logs generated by LogWeaver across all OpenClone services. It provides a rich, color-coded interface with filtering, search, and real-time updates for debugging and monitoring distributed applications.

## Architecture
- **Backend**: Python Flask application with PostgreSQL integration
- **Frontend**: React application with Bootstrap UI
- **Data Flow**: Queries OpenClone log database
- **Real-time Updates**: Uses localStorage caching with periodic database polling

## Key Features

### Real-Time Log Monitoring
- **Live Updates**: Periodically queries database for new logs
- **localStorage Caching**: Efficient client-side log storage and retrieval
- **Auto-Refresh**: Continuously updated view of system activity across all services

### Visual Organization
- **Color-Coded Applications**: Each application has distinct color scheme for easy identification. Set in /static/application-colors.css
  - **Website**: Teal (`rgb(10, 93, 97)`)
  - **SadTalker**: Blue-purple (`rgb(45, 43, 85)`)
  - **U-2-Net**: Blue (`rgb(56, 107, 216)`)
  - **ST_FFMPEG**: Green (`rgb(17, 97, 10)`)

### Rich Log Content Support
- **HTML Logging**: Applications can log HTML content (images, audio/video, formatted text)
- **Media Preview**: View deepfake generation progress through embedded images/audio/video
- **Security Consideration**: Developers should keep security in mind because of HTML logging.

### Advanced Filtering & Search
- **Application Filtering**: Show/hide logs from specific applications
- **Log Level Filtering**: Filter by INFO, WARNING, ERROR, DEBUG, CRITICAL
- **Time Range Filtering**: Custom date/time ranges or "last N minutes"
- **Third-Party Separation**: Toggle between OpenClone logs and third-party library logs

### Flexible Viewing Options
- **View Modes**: 
  - **Detailed View**: Full metadata and expanded log content
  - **Compact View**: Condensed display for high-volume monitoring
- **Sort Order**: Ascending or descending chronological order
- **Pagination**: Configurable page sizes (default: 250 logs)
- **Infinite Scroll**: Automatic loading of older logs when scrolling to bottom

### Navigation & Search
- **Go-To Functionality**: Jump directly to specific log entries by ID
- **Timestamp Navigation**: Precise time-based log location
- **Scroll Position Memory**: Maintains position during updates

## Technical Implementation

### Backend API (Flask)
**Endpoints:**
- `POST /get-log-ids`: Retrieves filtered list of log IDs
- `POST /get-logs`: Fetches log details for specific IDs
- `GET /OpenCloneFS/<path>`: Serves static files from OpenCloneFS

**Query Processing:**
- Dynamic SQL generation based on filter parameters
- Efficient pagination using log IDs
- PostgreSQL integration with connection pooling

### Frontend (React)
**Components:**
- **LogTable**: Main log display with pagination
- **Settings Modal**: Filter and display configuration
- **Goto Modal**: Direct navigation to specific logs
- **GroovySpinner**: Loading indicators

**State Management:**
- React hooks for real-time updates
- Local refs for performance optimization
- Error handling with user feedback

### Database Integration
**Query Optimization:**
- Two-phase loading: fetch IDs first, then log details
- Parameterized queries for security
- Efficient filtering at database level

**Log Metadata Display:**
```
ID | Run# | Application | Machine | Timestamp | Level | OpenClone | Message
```

## Environment Configuration
**Multi-Environment Support:**
- `--environment local|remote|kind`: Configure database connections
- Environment variables: Database host, port, credentials
- Development vs production database targeting

## File Structure
```
LogViewer/
├── API.py                     # Flask application and endpoints
├── Data.py                    # Database queries and data access
├── GlobalVariables.py         # Environment-specific configuration
├── Utils.py                   # Utility functions (time formatting, etc.)
├── requirements.txt           # Python dependencies
├── templates/
│   └── index.html            # Single-page React application shell
└── static/
    ├── application-colors.css # Color schemes for each application
    ├── site.css              # Main stylesheet
    ├── site.js               # Main React application
    ├── log-table-body.js     # Log display components
    ├── settings.js           # Configuration modal
    ├── goto.js               # Navigation functionality
    ├── data.js               # API communication layer
    ├── log-cache.js          # Client-side caching logic
    ├── utils.js              # JavaScript utilities
    └── groovy-spinner.*      # Loading animations
```

## Development Features
- **Debug Mode**: Flask debug enabled for development
- **Port Configuration**: Runs on port 1234 by default
- **Error Handling**: Comprehensive error display with stack traces

## Integration Points
- **Unified Database**: All applications write to the same PostgreSQL log database regardless of logging framework
- **OpenCloneFS**: Serves media files embedded in logs

## Use Cases
- **Development Debugging**: Real-time monitoring during development
- **Production Monitoring**: Track system health and performance
- **Deepfake Progress**: Visual monitoring of AI generation processes
- **Error Investigation**: Detailed error analysis with context
- **Performance Analysis**: Identify bottlenecks across services

## Security Considerations
- **HTML Content**: Logs can contain HTML - requires input validation (or thought about what gets logged in the first place)
- **Database Access**: Read-only access to logging database
- **File Serving**: Direct file access through OpenCloneFS endpoint